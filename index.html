<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="canonical" href="https://texasdentalhub.com/" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TexasDentalHub | Houston Metro Dentists</title>
  <link rel="canonical" id="canonicalLink" href="https://texasdentalhub.com/" />
  <meta name="description" content="Find trusted general and family dentists in Houston, Katy, Sugar Land, Richmond, Rosenberg, The Woodlands, and Spring, Texas." />
  <style>
/* ===================== BRAND ===================== */
.brand {
  font-size: 1.6rem;
  font-weight: 700;
  letter-spacing: -0.3px;
  display: flex;
  align-items: center;
  text-decoration: none;
}
.brand-name { color: #0f172a; }
.brand-hub { color: #0b5ed7; margin-left: 2px; }

.footer-brand .brand { font-size: 1.2rem; margin-bottom: 10px; }
.site-footer .brand-name { color: #ffffff; }
.site-footer .brand-hub { color: #93c5fd; }

/* ===================== VARIABLES ===================== */
:root {
  --bg: radial-gradient(circle at top, #f8fbff 0%, #eef4ff 35%, #eaf0fb 100%);
  --card: #ffffff;
  --text: #0f172a;
  --muted: #475569;
  --border: rgba(15,23,42,.08);

  --shadow-soft: 0 8px 20px rgba(2,6,23,.06);
  --shadow: 0 18px 40px rgba(2,6,23,.10);
  --shadow2: 0 12px 28px rgba(2,6,23,.12);

  --accent: #2563eb;
  --accentSoft: #eef4ff;

  --radius: 18px;
}

/* ===================== BASE ===================== */
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background: var(--bg);
  color: var(--text);
  line-height: 1.5;
}

html { scroll-behavior: smooth; }

/* ===================== TOPBAR ===================== */
.topbar {
  position: sticky;
  top: 0;
  z-index: 1000;
  background: rgba(255,255,255,.96);
  backdrop-filter: blur(8px);
  border-bottom: 1px solid rgba(15,23,42,0.08);
}
.topbar-inner {
  max-width: 1100px;
  margin: auto;
  padding: 14px 18px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* ===================== LAYOUT ===================== */
.container {
  max-width: 1100px;
  margin: auto;
  padding: 22px 18px 60px;
}
.page { display: none; }
.page.active { display: block; }

/* ===================== HERO ===================== */
.hero {
  background: linear-gradient(180deg, #f8fbff 0%, #eef5ff 100%);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 30px;
  box-shadow: var(--shadow);
}
.hero h1 {
  font-weight: 700;
  letter-spacing: -0.3px;
}
.hero p { color: var(--muted); }

/* ===================== FILTERS ===================== */
.filters {
  margin: 20px 0;
  background: #fff;
  border-radius: 14px;
  padding: 14px;
  box-shadow: 0 10px 25px rgba(2,6,23,.08);
  border: 1px solid var(--border);
}

.filter-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
}

/* Filter controls */
.filters select,
.filters input {
  appearance: none;
  padding: 10px 16px;
  border-radius: 999px;
  border: 1.5px solid var(--accent);
  font-size: 14px;
  font-weight: 500;
  background: #fff;
  color: var(--accent);
  cursor: pointer;
  transition: background .15s ease, color .15s ease, box-shadow .15s ease;
}

/* Dropdown arrow */
.filters select {
  background:
    #fff
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' fill='%2364758b'%3E%3Cpath d='M3 5l4 4 4-4'/%3E%3C/svg%3E")
    no-repeat right 14px center;
}

/* Hover */
.filters select:hover,
.filters input:hover {
  background: rgba(37,99,235,.08);
}

/* Focus */
.filters select:focus,
.filters input:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(37,99,235,.25);
}

/* Selected */
.filters select:not([value=""]):not(:focus),
.filters input:not(:placeholder-shown):not(:focus) {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent);
}

/* ===================== STICKY FILTER ===================== */
.sticky-filter {
  position: sticky;
  top: 64px;
  z-index: 9;
}
.sticky-filter.is-stuck {
  background: rgba(255,255,255,.96);
  backdrop-filter: blur(6px);
  box-shadow: 0 12px 26px rgba(2,6,23,.14);
}

/* ===================== MOBILE FILTER FIX (FINAL) ===================== */
@media (max-width: 768px) {
  .filter-row {
    grid-template-columns: repeat(2, 1fr);
    gap: 14px;
  }

  .filters select,
  .filters input {
    width: 100%;
    height: 44px;
  }
}

/* ===================== GRID / CARDS ===================== */
.grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
}
@media (max-width: 900px) { .grid { grid-template-columns: repeat(2,1fr); } }
@media (max-width: 600px) { .grid { grid-template-columns: 1fr; } }

.card {
  background: #fff;
  border-radius: var(--radius);
  border: 1px solid rgba(15,23,42,.06);
  box-shadow: var(--shadow-soft);
  padding: 18px;
  display: flex;
  flex-direction: column;
  transition: transform .18s ease, box-shadow .18s ease;
}
.card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow);
}

/* ===================== BUTTONS ===================== */
.btn {
  padding: 12px 16px;
  border-radius: 14px;
  border: none;
  background: linear-gradient(180deg, #3b82f6, #2563eb);
  color: #fff;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  display: inline-flex;
  justify-content: center;
  align-items: center;
  transition: transform .12s ease, box-shadow .12s ease;
}
.btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 10px 20px rgba(37,99,235,.35);
}
.btn:active {
  transform: scale(.98);
}

/* ===================== FOOTER ===================== */
.site-footer {
  background: #0f172a;
  color: #cbd5e1;
  padding: 60px 20px 30px;
}
.footer-grid {
  max-width: 1200px;
  margin: auto;
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
  gap: 40px;
}
.footer-bottom {
  margin-top: 40px;
  padding-top: 20px;
  border-top: 1px solid rgba(255,255,255,.1);
  text-align: center;
  font-size: 14px;
}
</style>

  
</head>
<body id="home">

<div class="topbar">
  <div class="topbar-inner">
   <div class="brand">
  <a href="index.html" class="brand">
  <span class="brand-name">TexasDental</span><span class="brand-hub">Hub</span>
</a>

</div>
  
<div class="nav">
  <select id="citySelect" class="city-select">
    <option value="">All Cities</option>
  </select>
</div>

<div id="clinicsContainer"></div>
        
  </div>
</div>

<div class="container"></div>



<div id="leadModal">
  <div class="modal">
    <h3>Request Appointment Online</h3>
    <p id="leadClinic" style="font-size:14px;color:#475569"></p>

<form id="leadForm">

  
  <input type="hidden" id="clinicNameInput" name="clinic_name" />

  <input name="patient_name" required placeholder="Your Name" />

  <input name="email" type="email" required placeholder="Email" />

  <input name="phone" required placeholder="Phone" />

  <textarea name="message" required placeholder="Please include a brief message (e.g. preferred time/ name of insurance)"></textarea>

 <div class="form-actions">
  <button class="btn" type="submit">Submit Request</button>

  <button
    type="button"
    class="btn secondary"
    onclick="closeLead()"
  >
    Cancel
  </button>
</div>

</form>
    
  </div>
</div>

<script>
  
window.SUPABASE_URL = "https://wehhvavlbhdbcmgvdaxj.supabase.co";
window.SUPABASE_KEY = "sb_publishable_HI7wHyO6rFnczXvvEGoldg_GF-Hd2DV";
</script>
  
<script>
  
  const ALL_CITIES_HERO_LABEL = 'Houston Metro Area';
// üîπ GitHub Pages base path (repo name)
const BASE_PATH = '/texas-dental-hub'; // ‚Üê replace with your repo name

  const DEFAULT_CITY_KEY = 'houston';
  const ALL_CITIES_KEY = 'all';

  // üîπ Read city from URL query string (?city=houston)
function getCityFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get('city');
}
  function setCanonical(url) {
  let link = document.querySelector('link[rel="canonical"]');
  if (!link) {
    link = document.createElement('link');
    link.rel = 'canonical';
    document.head.appendChild(link);
  }
  link.href = url;
}

/* ================= CONFIG ================= */
const SUPABASE_URL = 'https://wehhvavlbhdbcmgvdaxj.supabase.co';
const SUPABASE_KEY = 'sb_publishable_HI7wHyO6rFnczXvvEGoldg_GF-Hd2DV';

function getCityFromURL() {
  const parts = window.location.pathname.split('/').filter(Boolean);

  // /city/houston
  if (parts.length === 2 && parts[0] === 'city') {
    return parts[1];
  }

  return null;
}

let CITY_KEY_MAP = {};
let CITY_ORDER = [];
let CITY_KEY_LABEL = {};


/* üîπ Utility: city ‚Üí key */
function toCityKey(city) {
  return city
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '')
    .trim();
}

  // üîπ Clinic name ‚Üí URL-safe slug
function toClinicSlug(name) {
  return name
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/(^-|-$)/g, '');
}

// üîπ Read clinic slug from URL (?clinic=abc-family-dental)
function getClinicFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get('clinic');
}


function isClinicOpenNow(hoursText) {
  if (!hoursText) return false;

  const now = new Date();
  const day = now.getDay(); // 0=Sun, 1=Mon, ... 6=Sat
  const hour = now.getHours() + now.getMinutes() / 60;

  // Normalize text
  const text = hoursText.toLowerCase();

  // Weekend handling
  if (day === 0) return text.includes('sun');
  if (day === 6) return text.includes('sat');

  // Weekday handling (Mon‚ÄìFri)
  const match = text.match(/(\d{1,2})a\s*-\s*(\d{1,2})p/);
  if (!match) return false;

  let open = parseInt(match[1], 10);
  let close = parseInt(match[2], 10) + 12;

  return hour >= open && hour < close;
}



  async function loadCitiesFromSupabase() {
  console.log('‚ñ∂ loadCitiesFromSupabase called');

const res = await fetch(
  `${SUPABASE_URL}/rest/v1/clinics?select=name,address,phone,zip,city,services,insurances,featured,weekend_open`,
  {
    headers: {
      apikey: SUPABASE_KEY,
      Authorization: `Bearer ${SUPABASE_KEY}`
    }
  }
);
  const rows = await res.json();

  const cities = [...new Set(
    rows.map(r => (r.city || '').trim()).filter(Boolean)
  )].sort();

  const select = document.getElementById('citySelect');
  if (!select) {
    console.error('‚ùå citySelect not found');
    return;
  }

  // ‚úÖ RESET DROPDOWN ‚Äî MUST BE HERE
  select.innerHTML = '<option value="">All Cities</option>';

  CITY_KEY_MAP = {};
  CITY_ORDER = [];

  cities.forEach(city => {
    const key = toCityKey(city);

    CITY_KEY_MAP[city] = key;
    CITY_ORDER.push(key);
    CITY_KEY_LABEL[key] = city;


    const opt = document.createElement('option');
    opt.value = key;
    opt.textContent = city;
    select.appendChild(opt);
  });

  console.log('‚úÖ Cities populated:', CITY_ORDER);
}

 
let DATA = {};
let filters = {};

function ensureCityPages() {
  const container = document.querySelector('.container');
  if (!container) return;

  // üîπ Ensure All Cities page
  if (!document.getElementById(ALL_CITIES_KEY)) {
    const allPage = document.createElement('div');
    allPage.id = ALL_CITIES_KEY;
    allPage.className = 'page';
    container.prepend(allPage); // ‚¨ÖÔ∏è keep it first
  }

  // üîπ Ensure city pages
  CITY_ORDER.forEach(cityKey => {
    if (document.getElementById(cityKey)) return;

    const page = document.createElement('div');
    page.id = cityKey;
    page.className = 'page';
    container.appendChild(page);
  });
}
    
/* ================= LOAD DATA ================= */
async function loadClinicsFromSupabase() {
  const res = await fetch(`${SUPABASE_URL}/rest/v1/clinics?select=*`, {
    headers: {
      apikey: SUPABASE_KEY,
      Authorization: `Bearer ${SUPABASE_KEY}`
    }
  });
  
 
  const rows = await res.json();
  DATA = {};

  
  rows.forEach(c => {
    const cityName = (c.city || '').trim();
  const cityKey = toCityKey(cityName);

    if (!DATA[cityKey]) {
      DATA[cityKey] = { label: cityName, featured: [], clinics: [] };
    }

  const clinic = {
  name: c.name,
  address: c.address,
  phone: c.phone || '',
  zip: c.zip,
  services: c.services,
  insurances: c.insurances,
   // üî• AVAILABILITY TAGS (derived from weekend_open)
  availability: [
    'weekday', // all clinics are open on weekdays
   String(c.weekend_open).trim().toUpperCase() === 'YES' ? 'weekend' : null
  ].filter(Boolean),
     languages: c.languages || [],   // ‚úÖ ADD
  hours: c.hours || ''
};


    (c.featured ? DATA[cityKey].featured : DATA[cityKey].clinics).push(clinic);
  });

  console.log('Loaded cities:', Object.keys(DATA));
  activateCity(CITY_ORDER[0], true);

}

  // Added on 01/23/2025 to build combined DATA for ‚ÄúAll Cities‚Äù

function buildAllCitiesData() {
  const allFeatured = [];
  const allClinics = [];

  Object.entries(DATA).forEach(([key, city]) => {
    if (key === ALL_CITIES_KEY) return;

    allFeatured.push(...city.featured);
    allClinics.push(...city.clinics);
  });

  DATA[ALL_CITIES_KEY] = {
    label: 'All Cities',
    featured: allFeatured,
    clinics: allClinics
  };

  console.log('‚úÖ All Cities built:', DATA[ALL_CITIES_KEY]);
}

  
function renderCityLinks(currentCityKey) {
  const cities = CITY_ORDER.filter(key => key !== currentCityKey);

  // Rotate list based on current city position
  const start = CITY_ORDER.indexOf(currentCityKey);
  const rotated = cities
    .slice(start)
    .concat(cities.slice(0, start));

  return rotated
    .slice(0, 6)
    .map(key => {
      const label = CITY_KEY_LABEL[key] || key;
      return `<a href="?city=${key}">${label}</a>`;
    })
    .join(' ¬∑ ');
}



  
/* ================= RENDER ================= */
function renderCity(cityKey) {
  const city = DATA[cityKey];
  const page = document.getElementById(cityKey);
  if (!city || !page) return;
  
const isAllCities = cityKey === ALL_CITIES_KEY;

const heroLabel = isAllCities
  ? ALL_CITIES_HERO_LABEL
  : city.label;
  
  page.innerHTML = `
   <div class="hero">
  <h2>Trusted Dentists in ${heroLabel}</h2>

  <p class="city-service-line">
    General, family, cosmetic, preventive, and emergency dental care
  </p>

  <p>
Looking for a trusted dentist in  ${heroLabel}? <strong> TexasDental Hub </strong> connects you with verified dental clinics serving ${heroLabel} and nearby Texas communities.
Compare providers, contact clinics directly and request appointments online ‚Äî all in one place. </p>
 </div>

    <div class="filters sticky-filter">
       
  <select id="filter-service">
    <option value="">All Services</option>
    <option value="general">General Dentistry</option>
    <option value="family">Family Dentistry</option>
    <option value="cosmetic">Cosmetic</option>
    <option value="emergency">Emergency</option>
    <option value="pediatric">Pediatric</option>
  </select>

  <select id="filter-insurance">
    <option value="">All Insurance</option>
    <option value="delta">Delta Dental</option>
    <option value="aetna">Aetna</option>
    <option value="cigna">Cigna</option>
    <option value="metlife">MetLife</option>
    <option value="selfpay">No Insurance / Self-Pay</option>
  </select>

<select id="filter-availability">
  <option value="">Any Availability</option>
  <option value="weekday">Open Weekdays</option>
  <option value="weekend">Open Weekends</option>
</select>

<input
  type="text"
  id="filter-zip"
  placeholder="ZIP Code"
  inputmode="numeric"
  maxlength="5"
/>

</div>
  

<div class="no-results" style="display:none;text-align:center;margin:40px 0;color:#475569;">
  <h3>No clinics match your filters</h3>
  <p>Try adjusting or clearing your filters to see more clinics.</p>
  <button class="btn" onclick="resetFilters()">Clear Filters</button>
</div>

   <div class="section all-section">

      <div class="grid">
        ${city.clinics.map(c => card(c, false)).join('')}
      </div>
    </div>



<section class="city-links">
  <h3>Browse Dentists in Nearby Cities</h3>
  <p>${renderCityLinks(cityKey)}</p>
</section>

    
  `;

  
  page.dataset.rendered = 'true';
  
}
function updateResultsHeading(cityName) {
  const heading = document.getElementById('resultsHeading');
  if (!heading) return;

  const displayCity = cityName && cityName !== 'All'
    ? `${cityName}, TX`
    : 'Houston Metro';

  heading.innerHTML = `
    <span class="section-icon">‚úî</span>
    Verified Dentists in ${displayCity}
  `;
}

  function populateZipFilter(cityKey) {
  const city = DATA[cityKey];
  if (!city) return;

  const page = document.getElementById(cityKey);
  if (!page) return;

  const zipSelect = page.querySelector('#filter-zip');
  if (!zipSelect) return;

  // Collect unique ZIPs (ignore nulls)
  const zips = new Set();

  [...city.featured, ...city.clinics].forEach(c => {
 if (c.zip) zips.add(String(c.zip));

  });

  // Reset dropdown
  zipSelect.innerHTML = `<option value="">All ZIP Codes</option>`;

  [...zips].sort().forEach(zip => {
    const opt = document.createElement('option');
    opt.value = zip;
    opt.textContent = zip;
    zipSelect.appendChild(opt);
  });
}

/* ================= CARD ================= */
function card(c, isFeatured) {
  const services = (c.services || []).join(' ');
  const insurances = (c.insurances || []).join(' ');

  const availability = [
  'weekday',
  String(c.weekend_open)
    .trim()               // üî• IMPORTANT
    .toUpperCase() === 'YES'
    ? 'weekend'
    : null
].filter(Boolean).join('|');

const action = `
  <div class="actions">
    ${c.phone ? `
      <button class="btn call-btn"
        data-phone="${c.phone}"
        data-name="${c.name}"
        data-city="${c.city || 'No City Name'}">
        Call to Schedule
      </button>
    ` : ''}

    <button class="btn secondary"
      onclick="openLead('${c.name}')">
      Request Appointment
    </button>
  </div>
`;

  return `
    <div class="card ${isFeatured ? 'featured' : ''}"
      data-clinic="${toClinicSlug(c.name)}"
      data-zip="${c.zip ? String(c.zip) : ''}"
      data-service="${services}"
      data-insurance="${insurances}"
     data-availability="${c.availability.join('|')}">
            <span class="badge">${isFeatured ? '‚≠ê Featured Clinic' : 'Clinic'}</span>

     <h3> ${c.name}</h3>
<div class="address">

  <a
    href="https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(c.address)}"
    class="directions-btn"
    target="_blank"
    rel="noopener"
  >
    Directions
  </a>
</div>

      ${action}
    </div>
  `;
}

  function getUniqueServicesRaw(cityKey) {
  const city = DATA[cityKey];
  if (!city) return [];

  const set = new Set();

  [...city.featured, ...city.clinics].forEach(c => {
    (c.services || []).forEach(s => {
      if (s) set.add(s.trim());
    });
  });

  return [...set].sort();
}

function getUniqueInsurancesRaw(cityKey) {
  const city = DATA[cityKey];
  if (!city) return [];

  const set = new Set();

  [...city.featured, ...city.clinics].forEach(c => {
    (c.insurances || []).forEach(i => {
      if (i) set.add(i.trim());
    });
  });

  return [...set].sort();
}

function populateDynamicFilters(cityKey) {
  const page = document.querySelector('.page.active');
  if (!page) return;

  const serviceSelect = page.querySelector('#filter-service');
  const insuranceSelect = page.querySelector('#filter-insurance');

  if (!serviceSelect || !insuranceSelect) return;

  // Services
  const services = getUniqueServicesRaw(cityKey);
  serviceSelect.innerHTML = '<option value="">All Services</option>';

  services.forEach(s => {
    const opt = document.createElement('option');
    opt.value = s;
    opt.textContent = s;
    serviceSelect.appendChild(opt);
  });

  // Insurances
  const insurances = getUniqueInsurancesRaw(cityKey);
  insuranceSelect.innerHTML = '<option value="">All Insurance</option>';

  insurances.forEach(i => {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = i;
    insuranceSelect.appendChild(opt);
  });
}

function updateSEO(cityKey) {
  // ‚õëÔ∏è SAFETY GUARD ‚Äî prevents site break
  if (!DATA || !DATA[cityKey]) return;

  const city = DATA[cityKey];
  const cityName = city.label;

  document.title =
    cityKey === ALL_CITIES_KEY
      ? 'TexasDentalHub | Houston Metro Dentists'
      : `Dentists in ${cityName}, TX | TexasDentalHub`;

  const meta = document.querySelector('meta[name="description"]');
  if (meta) {
    meta.setAttribute(
      'content',
      cityKey === ALL_CITIES_KEY
        ? 'Find trusted general and family dentists across the Houston metro area.'
        : `Find trusted general and family dentists in ${cityName}, Texas. Browse verified local clinics and contact them directly.`
    );
  }

  const canonical = document.getElementById('canonicalLink');
  if (canonical) {
    canonical.href =
      cityKey === ALL_CITIES_KEY
        ? 'https://texasdentalhub.com/'
        : `https://texasdentalhub.com/city/${cityKey}`;
  }
}
 
/* ================= CITY SWITCH ================= */
function activateCity(cityKey, initial = false) {
  document.querySelectorAll('.page').forEach(p => {
    p.classList.remove('active');
    p.style.display = 'none';
  });

  const page = document.getElementById(cityKey);
  if (!page) return;

  page.classList.add('active');
  page.style.display = 'block';
// üîπ City page typography context
document.body.classList.add('city-view');
document.body.classList.remove('clinic-view');

  if (!page.dataset.rendered) {
    renderCity(cityKey);
      }
  
   updateSEO(cityKey); // üî• THIS IS STEP 4
  populateZipFilter(cityKey);
  populateDynamicFilters(cityKey); // ‚úÖ now defined
  wireFilters();
  applyFilters();


}

/* ================= FILTERS ================= */
function wireFilters() {
  const activePage = document.querySelector('.page.active');
  if (!activePage) return;

  filters = {
    zip: activePage.querySelector('#filter-zip'),
    service: activePage.querySelector('#filter-service'),
    insurance: activePage.querySelector('#filter-insurance'),
    availability: activePage.querySelector('#filter-availability')
  };

  Object.values(filters).forEach(f => {
    if (f) f.onchange = applyFilters;
  });
}


function applyFilters() {
  const page = document.querySelector('.page.active');
  if (!page) return;

  const cards = page.querySelectorAll('.card');


  let visibleCount = 0;

  cards.forEach(card => {
    let show = true;

    if (filters.zip?.value &&
        card.dataset.zip !== filters.zip.value) show = false;

    if (filters.service?.value &&
        !card.dataset.service.includes(filters.service.value)) show = false;

    if (filters.insurance?.value &&
        !card.dataset.insurance.includes(filters.insurance.value)) show = false;

 if (filters.availability?.value) {
  const avail = (card.dataset.availability || '').split('|');
  if (!avail.includes(filters.availability.value)) show = false;
}


    card.style.display = show ? 'flex' : 'none';
    if (show) visibleCount++;
  });


  
  // ‚úÖ Empty state toggle
const emptyState = page.querySelector('.no-results');
const featuredSection = page.querySelector('.featured-section');
const allSection = page.querySelector('.all-section');

if (visibleCount === 0) {
  if (emptyState) emptyState.style.display = 'block';
  if (featuredSection) featuredSection.style.display = 'none';
  if (allSection) allSection.style.display = 'none';
} else {
  if (emptyState) emptyState.style.display = 'none';
  if (featuredSection) featuredSection.style.display = '';
  if (allSection) allSection.style.display = '';
}

}
  
function resetFilters() {
  Object.values(filters).forEach(f => f && (f.value = ''));
  applyFilters();
}

/* ================= LEADS ================= */
function openLead(name) {
  document.getElementById('leadClinic').innerText = `Clinic: ${name}`;

  // üîí Persist clinic name safely
  document.getElementById('clinicNameInput').value = name;

  document.getElementById('leadModal').style.display = 'flex';
}

  
function closeLead() {
  document.getElementById('leadModal').style.display = 'none';
}

  document.getElementById('leadModal').addEventListener('click', e => {
  if (e.target.id === 'leadModal') closeLead();
});


async function submitLead(e) {
  e.preventDefault();

  const form = e.target;

  const payload = {
    clinic_name: document.getElementById('clinicNameInput').value,
    
    city: document.getElementById('citySelect').value,

    patient_name: form.querySelector('[name="patient_name"]').value.trim(),
    email: form.querySelector('[name="email"]').value.trim(),
    phone: form.querySelector('[name="phone"]').value.trim(),
    message: form.querySelector('[name="message"]').value.trim()
  };

  if (!payload.clinic_name) {
    alert('‚ùå Please select a clinic first.');
    return;
  }

  try {
    /* 1Ô∏è‚É£ Save lead */
    const dbRes = await fetch(`${SUPABASE_URL}/rest/v1/leads`, {
      method: 'POST',
      headers: {
        apikey: SUPABASE_KEY,
        Authorization: `Bearer ${SUPABASE_KEY}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });

    if (!dbRes.ok) {
      console.error(await dbRes.text());
      alert('‚ùå Failed to submit request.');
      return;
    }

   
    /* 2Ô∏è‚É£ Email notification (non-blocking) */
    fetch(`${SUPABASE_URL}/functions/v1/send-lead-email`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    }).catch(() => {});

    /* 3Ô∏è‚É£ UX */
    alert('‚úÖ Appointment request submitted successfully!');
    form.reset();
    document.getElementById('clinicNameInput').value = '';
    closeLead();

  } catch (err) {
    console.error(err);
    alert('‚ùå Network error.');
  }
}


/* ================= NAV ================= */
document.getElementById('citySelect').addEventListener('change', e => {
  resetFilters();

  const key = e.target.value || ALL_CITIES_KEY;

  // üî• Exit clinic view if active
  document.body.classList.remove('clinic-view');

  if (key === ALL_CITIES_KEY) {
    window.history.replaceState({}, '', window.location.pathname);
  } else {
    window.history.replaceState({}, '', `?city=${key}`);
  }

  activateCity(key);

  // üî• Scroll to top on city change
  window.scrollTo({ top: 0, behavior: 'smooth' });
});



  /* ================= ZIP FILTER (EVENT DELEGATION) ================= */
document.addEventListener("input", (e) => {
  if (!e.target || e.target.id !== "filter-zip") return;

  const zip = e.target.value.trim();

  // üî• Auto-filter ONLY when ZIP is complete
  if (zip.length === 5) {
    applyFilters();
  }

  // Optional: clear filter when ZIP is erased
  if (zip.length === 0) {
    applyFilters();
  }
});

  
function getCityFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get('city');
}

  //-----------------added on 01/28/2026-------//
function formatClinicHours(hours) {
  if (!hours) return '';

  // 1Ô∏è‚É£ Plain string
  if (typeof hours === 'string') {
    return hours;
  }

  // 2Ô∏è‚É£ Array
  if (Array.isArray(hours)) {
    return hours.join(', ');
  }

  // 3Ô∏è‚É£ Object
  if (typeof hours === 'object') {

    // üî• CASE: { raw: '{"text":"M-Th: 9a-5p; F: 9a-3p"}' }
    if (typeof hours.raw === 'string') {
      try {
        const parsed = JSON.parse(hours.raw);
        if (typeof parsed.text === 'string') {
          return parsed.text;
        }
      } catch (e) {
        // fallback
        return hours.raw;
      }
    }

    // CASE: { text: "..." }
    if (typeof hours.text === 'string') {
      return hours.text;
    }

    // CASE: { M: "9a-5p", Fri: "8a-1p" }
    return Object.entries(hours)
      .map(([day, value]) => value ? `${day}: ${value}` : null)
      .filter(Boolean)
      .join(', ');
  }

  return '';
}


function toSchemaOpeningHours(hoursText) {
  // ‚úÖ Must be a non-empty string
  if (typeof hoursText !== 'string' || !hoursText.trim()) {
    return undefined;
  }

  const text = hoursText.replace(/\s+/g, ' ').trim();

  const dayMap = {
    'M': 'Mo',
    'T': 'Tu',
    'W': 'We',
    'Th': 'Th',
    'F': 'Fr',
    'Sat': 'Sa',
    'Sun': 'Su'
  };

  const parts = [];

  text.split(',').forEach(r => {
    const match = r.match(/([A-Za-z\-]+):\s*(\d{1,2})a-(\d{1,2})p/i);
    if (!match) return;

    let days = match[1];
    let open = match[2].padStart(2, '0') + ':00';
    let close = (parseInt(match[3], 10) + 12).toString().padStart(2, '0') + ':00';

    if (days.includes('-')) {
      const [start, end] = days.split('-');
      days = `${dayMap[start]}-${dayMap[end]}`;
    } else {
      days = dayMap[days] || days;
    }

    parts.push(`${days} ${open}-${close}`);
  });

  return parts.length ? parts.join(', ') : undefined;
}



 function injectClinicSchema(clinic, clinicCity) {
  const old = document.getElementById('clinic-schema');
  if (old) old.remove();

  const openingHours = toSchemaOpeningHours(clinic.hours);

  const schema = {
    "@context": "https://schema.org",
    "@type": "Dentist",
    "name": clinic.name,
    "telephone": clinic.phone || undefined,
    "address": {
      "@type": "PostalAddress",
      "streetAddress": clinic.address,
      "addressLocality": clinicCity,
      "addressRegion": "TX",
      "postalCode": clinic.zip || undefined,
      "addressCountry": "US"
    },
    "availableLanguage": clinic.languages || undefined,
    "openingHours": openingHours
  };

  const script = document.createElement('script');
  script.type = 'application/ld+json';
  script.id = 'clinic-schema';
  script.textContent = JSON.stringify(schema);

  document.head.appendChild(script);
}

  
 function renderClinicPage(slug) {
  let clinic = null;
  let clinicCity = null;

Object.entries(DATA).forEach(([key, city]) => {
  // ‚ùå Skip the aggregated All Cities bucket
  if (key === ALL_CITIES_KEY) return;

  [...city.featured, ...city.clinics].forEach(c => {
    if (toClinicSlug(c.name) === slug) {
      clinic = c;
      clinicCity = city.label;
    }
  });
});

   
  if (!clinic) {
    document.querySelector('.container').innerHTML = `
      <div class="hero">
              <h1>Clinic not found</h1>
              
       <p class="back-to-city">
  <a href="?city=${toCityKey(clinicCity)}" class="directions-btn">
    ‚Üê Browse more dentists in ${clinicCity}
  </a>
</p>

        
      </div>
    `;
    return;
  }

   document.body.classList.add('clinic-view');

// üî• Scroll to top when clinic page loads
window.scrollTo({ top: 0, behavior: 'smooth' });

   injectClinicSchema(clinic, clinicCity);
   

  // SEO
  document.title = `${clinic.name} | Dentist in ${clinicCity || 'Texas'}`;
  const meta = document.querySelector('meta[name="description"]');
  if (meta) {
    meta.setAttribute(
      'content',
      `${clinic.name} is a verified dental clinic in Texas. View services, location, and contact details.`
    );
  }
   // üî• Canonical URL (clinic pages ONLY)
setCanonical(`https://texasdentalhub.com/?clinic=${slug}`);

  // Render page
document.querySelector('.container').innerHTML = `
  <section class="clinic-detail">

    <!-- Header -->
    <header class="clinic-header">
      <h1 class="clinic-title">${clinic.name}</h1>
      <div class="clinic-title-divider"></div>


      <div class="clinic-subtitle">
        ${clinicCity ? `<span>${clinicCity}, TX</span>` : ''}
           </div>




<div class="clinic-cta">
  ${
    clinic.phone
      ? `
        <button
          type="button"
          class="btn"
          onclick="callClinic(
            '${clinic.phone}',
            '${clinic.name}',
            '${clinicCity || ''}'
          )">
          Call Clinic
        </button>
      `
      : ''
  }

  <button class="btn secondary" onclick="openLead('${clinic.name}')">
    Request Appointment
  </button>
</div>


    <p class="back-to-city">
  <a href="?city=${toCityKey(clinicCity)}" class="directions-btn">
    ‚Üê Browse more dentists in ${clinicCity}
  </a>
</p>

      
    </header>

   

    <!-- Info Card -->
    <div class="clinic-card">

      <div class="info-row">
        <strong>Address</strong>
        <span>${clinic.address}</span>
      </div>

      ${formatClinicHours(clinic.hours) ? `
        <div class="info-row">
          <strong>Operating Hours</strong>
          <span>${formatClinicHours(clinic.hours)}</span>
        </div>
      ` : ''}

      ${clinic.languages?.length ? `
        <div class="info-row">
          <strong>Languages</strong>
          <span>${clinic.languages.join(', ')}</span>
        </div>
      ` : ''}

      ${clinic.services?.length ? `
        <div class="info-row">
          <strong>Services</strong>
          <span>${clinic.services.join(', ')}</span>
        </div>
      ` : ''}

      ${clinic.insurances?.length ? `
        <div class="info-row">
          <strong>Insurance</strong>
          <span>${clinic.insurances.join(', ')}</span>
        </div>
      ` : ''}

    </div>



  </section>
`;

}

  

  /* ================= START ================= */
(async () => {
  await loadCitiesFromSupabase();
  ensureCityPages();
  await loadClinicsFromSupabase();
  buildAllCitiesData();

 const clinicSlug = getClinicFromURL();
const urlCity = getCityFromURL();

if (clinicSlug) {
  renderClinicPage(clinicSlug);
  return;
}

  if (urlCity && CITY_ORDER.includes(urlCity)) {
    activateCity(urlCity, true);
    document.getElementById('citySelect').value = urlCity;
  } else if (CITY_ORDER.includes(DEFAULT_CITY_KEY)) {
    activateCity(DEFAULT_CITY_KEY, true);
    document.getElementById('citySelect').value = DEFAULT_CITY_KEY;
  } else {
    const fallbackCity = CITY_ORDER[0];
    activateCity(fallbackCity, true);
    document.getElementById('citySelect').value = fallbackCity;
  }
})();


function callClinic(phone, clinic) {
  if (!phone) return;

  if (/Mobi|Android/i.test(navigator.userAgent)) {
    window.location.href = `tel:${phone}`;
  } else {
    alert(
      `Call ${clinic}\n\nPhone: ${phone}\n\nTip: This works best on a mobile phone.`
    );
  }
}

document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('leadForm');
  if (form) {
    form.addEventListener('submit', submitLead);
  }
});

  /* Show Form When Linked (Clean JS)  */
window.addEventListener("hashchange", () => {
    if (location.hash === "#contact") {
      const section = document.getElementById("contact");
      if (section) section.style.display = "block";
    }
  });

  if (location.hash === "#contact") {
    const section = document.getElementById("contact");
    if (section) section.style.display = "block";
  }
  
</script>

  <div id="clinics"></div>

<script>
  function openContactForm(e) {
    e.preventDefault();

    const section = document.getElementById("contact");
    if (!section) return;

    section.style.display = "block";
    section.scrollIntoView({ behavior: "smooth" });
  }
</script>
  
  <section id="contact" class="contact-section" style="display:none;">
  <h2>Contact Us</h2>
  <p class="contact-subtext">
    Have a question or want to list your dental clinic on TexasDentalHub?
    Send us a message and we‚Äôll get back to you.
  </p>

   
  <form class="contact-form">
    <div class="form-group">
      <label for="name">Full Name</label>
      <input type="text" id="name" name="name" placeholder="Your name" required />
    </div>

    <div class="form-group">
      <label for="email">Email Address</label>
      <input type="email" id="email" name="email" placeholder="you@example.com" required />
    </div>

    <div class="form-group">
      <label for="message">Message</label>
      <textarea
        id="message"
        name="message"
        rows="5"
        placeholder="Tell us how we can help..."
        required
      ></textarea>
    </div>

    <button type="submit" class="btn-primary">Send Message</button>
  </form>
</section>

  <footer class="site-footer">
  <div class="footer-grid">
    
    <!-- Brand -->
  <div class="footer-brand">
  <div class="brand">
    <span class="brand-name">TexasDental</span><span class="brand-hub">Hub</span>
  </div>

  <p>
    Your trusted directory for finding verified dentists across Texas.
    We help patients connect with local dental clinics for quality, affordable dental care.
  </p>
</div>


    <!-- Cities -->
    <div>
      <h4>Popular Cities</h4>
      <ul>
        <li>Houston</li>
        <li>Katy</li>
        <li>Sugar Land</li>
        <li>Richmond</li>
        <li>Rosenberg</li>
        <li>The Woodlands</li>
        <li>Spring</li>
      </ul>
    </div>


   
    <!-- Links -->
    <div>
  <h4>Quick Links</h4>
  <ul>
    <li><a href="#home">Home</a></li>
    <li><a href="#clinics">Browse Dentists</a></li>
    <li><a href="contact.html">Contact Us</a></li>
    <li><a href="about.html">About TexasDentalHub</a></li>

  </ul>
</div>

       <!-- Dentists -->
  <div>
  <h4>For Dentists</h4>
  <ul>
    <li>
      <a href="contact.html">
        List Your Dental Practice
      </a>
    </li>
    <li>
      <a href="contact.html">
        Claim an Existing Listing
      </a>
    </li>
    <li>
      <a href="contact.html">
        Get More Patient Leads
      </a>
    </li>
    <li>
      <a href="contact.html">
        Advertising & Featured Listings
      </a>
    </li>
  </ul>
</div>


  </div>

  <div class="footer-bottom">
    <p>¬© 2026 TexasDentalHub. All rights reserved.</p>
    <p>
      <a href="privacy.html">Privacy Policy</a> |
      <a href="terms.html">Terms of Service</a> |
      <a href="disclaimer.html">Disclaimer</a>
    </p>
  </div>
</footer>


<script>
  const topbar = document.querySelector(".topbar");

  if (topbar) {
    window.addEventListener("scroll", () => {
      if (window.scrollY > 10) {
        topbar.classList.add("scrolled");
      } else {
        topbar.classList.remove("scrolled");
      }
    });
  }
</script>

<script>

  
document.addEventListener("DOMContentLoaded", () => {

  function initFilters() {
    const serviceFilter = document.getElementById("filter-service");
    const insuranceFilter = document.getElementById("filter-insurance");
    const availabilityFilter = document.getElementById("filter-availability");
    const zipInput = document.getElementById("filter-zip");

    if (!serviceFilter || !insuranceFilter || !availabilityFilter || !zipInput) {
   
      setTimeout(() => document.dispatchEvent(new Event("initFilters")), 300);
      return;
    }

    function applyFilters() {
      const service = serviceFilter.value;
      const insurance = insuranceFilter.value;
      const availability = availabilityFilter.value;
      //const zip = zipInput.value.trim();
      const zip = document.getElementById("filter-zip")?.value.trim();

       document.querySelectorAll(".card").forEach(card => {
        const cardService = card.dataset.service || "";
        const cardInsurance = card.dataset.insurance || "";
        const cardAvailability = card.dataset.availability || "";
        const cardZip = card.dataset.zip || "";
        // added the below on 01/16/2026
        //const matchesZip = !zip || cardZip.startsWith(zip);

        const matchesService = !service || cardService.includes(service);
        const matchesInsurance = !insurance || cardInsurance.includes(insurance);
        const matchesAvailability = !availability || cardAvailability.includes(availability);
        const matchesZip = !zip || cardZip.startsWith(zip);

        card.style.display =
          matchesService &&
          matchesInsurance &&
          matchesAvailability &&
          matchesZip
            ? ""
            : "none";
      });
    }

    serviceFilter.addEventListener("change", applyFilters);
    insuranceFilter.addEventListener("change", applyFilters);
    availabilityFilter.addEventListener("change", applyFilters);
    zipInput.addEventListener("input", applyFilters);

    console.log("Filters initialized successfully");
  }

  document.addEventListener("initFilters", initFilters);
  initFilters();

});


let callInProgress = false;

document.addEventListener('click', function (e) {
  const btn = e.target.closest('.call-btn');
  if (!btn) return;

  e.preventDefault();
  e.stopPropagation();

  // Prevent double-fire
  if (callInProgress) return;
  callInProgress = true;

  const phone = btn.dataset.phone;
  const name = btn.dataset.name;
  const city = btn.dataset.city;

  callClinic(phone, name, city);

  // Release lock shortly after
  setTimeout(() => {
    callInProgress = false;
  }, 1500);
});


document.addEventListener('click', function (e) {
  const card = e.target.closest('.card');
  if (!card) return;

  // ‚ùå Ignore clicks on buttons, links, inputs
  if (
    e.target.closest('button') ||
    e.target.closest('a') ||
    e.target.closest('input') ||
    e.target.closest('textarea')
  ) {
    return;
  }

  const slug = card.dataset.clinic;
  if (!slug) return;

  // Navigate to clinic page
  window.history.pushState({}, '', `?clinic=${slug}`);
  renderClinicPage(slug);
});

  

 </script>


  <script>
function callClinic(phone, clinicName, city) {
  // 1Ô∏è‚É£ Open dialer immediately (user gesture preserved)
  window.location.href = `tel:${phone}`;

  // 2Ô∏è‚É£ Send lead in background
  fetch('https://wehhvavlbhdbcmgvdaxj.supabase.co/rest/v1/leads', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    apikey: SUPABASE_KEY,
Authorization: `Bearer ${SUPABASE_KEY}`

    },
    body: JSON.stringify({
      clinic_name: clinicName,
      city: city,
      patient_name: 'Phone Call',
      email: 'noreply@texasdentalhub.com',
      phone: phone || 'N/A',
      message: 'Call to Schedule click',
      source: 'call'
    })
  }).catch(() => {});


    // 2Ô∏è‚É£ Device-aware behavior
  const isMobile = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);

  if (isMobile) {
    // üì± Mobile ‚Üí open dialer
    window.location.href = `tel:${phone}`;
  } else {
    // üíª Desktop ‚Üí show call info
    alert(
      `Call ${clinicName}\n\nPhone: ${phone}\n\nTip: This works best on a mobile phone.`
    );
  }
}


</script>


  
</body>
</html>
